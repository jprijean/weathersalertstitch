<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Weather Alert Dashboard</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#137fec",
                    "background-light": "#f6f7f8",
                    "background-dark": "#101922",
                },
                fontFamily: {
                    "display": ["Inter", "sans-serif"]
                },
                borderRadius: {
                    "DEFAULT": "0.5rem",
                    "lg": "1rem",
                    "xl": "1.5rem",
                    "full": "9999px"
                },
            },
        },
    }
</script>
<style>
    .material-symbols-outlined {
      font-variation-settings:
      'FILL' 0,
      'wght' 400,
      'GRAD' 0,
      'opsz' 24
    }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
<div class="layout-container flex h-full grow flex-col">
<div class="px-4 sm:px-8 md:px-12 lg:px-20 xl:px-40 flex flex-1 justify-center py-5">
<div class="layout-content-container flex flex-col w-full max-w-7xl flex-1">

<header class="flex flex-wrap justify-between items-start gap-4 p-4 mb-4">
<div class="flex flex-col gap-2">
<h1 class="text-slate-900 dark:text-slate-50 text-4xl font-black leading-tight tracking-[-0.033em]">Weather Alert Dashboard</h1>
<p class="text-slate-500 dark:text-slate-400 text-base font-normal leading-normal">Live building weather data - Compact Forecast</p>
</div>
<div class="flex flex-col sm:flex-row items-end sm:items-center gap-4">
<p id="last-updated" class="text-slate-500 dark:text-slate-400 text-sm font-normal leading-normal order-2 sm:order-1">Last updated: -</p>
<button id="refresh-button" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-slate-200/80 dark:bg-slate-800/80 text-slate-900 dark:text-slate-50 gap-2 text-sm font-bold leading-normal tracking-[0.015em] hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors order-1 sm:order-2">
<span class="material-symbols-outlined text-lg">refresh</span>
<span class="truncate">Refresh Data</span>
</button>
</div>
</header>

<main class="grid grid-cols-1 gap-6 p-4" id="cards-container">
  <!-- Cards will be dynamically inserted here -->
</main>

<footer class="p-4 mt-8">
<div class="p-6 rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900/70">
<h3 class="text-lg font-bold text-slate-800 dark:text-slate-100 mb-4">Intervention Status Legend</h3>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
<div class="flex items-center gap-3">
<div class="w-6 h-6 rounded-full bg-green-500 border border-green-600 dark:border-green-400"></div>
<div class="flex flex-col">
<p class="font-semibold text-slate-700 dark:text-slate-200">Normal</p>
<p class="text-xs text-slate-500 dark:text-slate-400">No intervention required.</p>
</div>
</div>
<div class="flex items-center gap-3">
<div class="w-6 h-6 rounded-full bg-orange-500 border border-orange-600 dark:border-orange-400"></div>
<div class="flex flex-col">
<p class="font-semibold text-slate-700 dark:text-slate-200">Warning / Watch</p>
<p class="text-xs text-slate-500 dark:text-slate-400">Potential for intervention.</p>
</div>
</div>
<div class="flex items-center gap-3">
<div class="w-6 h-6 rounded-full bg-amber-500 border border-amber-600 dark:border-amber-400"></div>
<div class="flex flex-col">
<p class="font-semibold text-slate-700 dark:text-slate-200">Intervention</p>
<p class="text-xs text-slate-500 dark:text-slate-400">Immediate action required.</p>
</div>
</div>
<div class="flex items-center gap-3">
<div class="w-6 h-6 rounded-full bg-slate-500 border border-slate-600 dark:border-slate-400"></div>
<div class="flex flex-col">
<p class="font-semibold text-slate-700 dark:text-slate-200">Future Intervention</p>
<p class="text-xs text-slate-500 dark:text-slate-400">Intervention required soon.</p>
</div>
</div>
</div>
</div>
</footer>

</div>
</div>
</div>
</div>

<script>
const cardsContainer = document.querySelector('#cards-container');
const refreshButton = document.querySelector('#refresh-button');
const lastUpdated = document.querySelector('#last-updated');

// Color thresholds
function getColor(value, type) {
    if(type === 'wind') {
        if(value <= 15) return 'bg-green-50 border-green-500';
        if(value <= 30) return 'bg-orange-50 border-orange-500';
        return 'bg-red-50 border-red-500';
    }
    if(type === 'precipitation') {
        if(value == 0) return 'bg-green-50 border-green-500';
        if(value <= 10) return 'bg-orange-50 border-orange-500';
        return 'bg-red-50 border-red-500';
    }
    return '';
}

// Fetch results and update cards
async function fetchResults() {
    try {
        const response = await fetch('/results'); // Adjust your endpoint if needed
        const data = await response.json();

        cardsContainer.innerHTML = ''; // clear old cards

        data.forEach(location => {
            const windColor = getColor(location.windspeed, 'wind');
            const precipitationColor = getColor(location.precipitation, 'precipitation');

            const cardHtml = `
                <div class="flex flex-col rounded-xl shadow-md hover:shadow-lg transition-all duration-300 ease-in-out border ${windColor}">
                  <div class="flex items-center justify-between gap-3 px-4 py-2 bg-white rounded-t-xl border-b border-slate-200">
                    <div class="flex items-center gap-3">
                      <span class="material-symbols-outlined text-2xl">thermostat</span>
                      <h3 class="text-base font-bold text-slate-800">${location.building_code}</h3>
                    </div>
                    <span class="text-sm font-semibold text-slate-800">
                      Intervention: ${location.intervention || 'Normal'}
                    </span>
                  </div>
                  <div class="flex flex-col md:flex-row gap-4 p-4">
                    <div class="flex flex-col justify-center items-center md:items-start md:w-1/3 lg:w-1/4">
                      <div class="grid grid-cols-2 gap-4">
                        <div class="p-3 rounded-lg bg-white border border-slate-200">
                          <p class="text-xs text-slate-500">Wind</p>
                          <p class="text-2xl font-bold text-slate-800">
                            ${location.windspeed} <span class="text-sm font-medium text-slate-500">km/h</span>
                          </p>
                        </div>
                        <div class="p-3 rounded-lg bg-white border border-slate-200">
                          <p class="text-xs text-slate-500">Precipitation</p>
                          <p class="text-2xl font-bold text-slate-800">
                            ${location.precipitation} <span class="text-sm font-medium text-slate-500">mm</span>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
            `;
            cardsContainer.innerHTML += cardHtml;
        });

        lastUpdated.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
    } catch (error) {
        console.error('Error fetching results:', error);
        lastUpdated.textContent = 'Last updated: Error fetching data';
    }
}

// Attach refresh button
refreshButton.addEventListener('click', fetchResults);

// Load immediately
fetchResults();
</script>
</body>
</html>
